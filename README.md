# onecover
Репозитарий для экспериментов с расчетом покрытия тестами в 1С

### Подход:
1. Поднимаем прокси-сервер отладки:
   `./proxy/docker-compose up -d`
    * Настраиваем отслеживание перенаправление POST-запросов на порт 11550 на сервер 1С порт 1550
    * Настраиваем логирование всех POST-запросов на порт 11550
2. Поднимаем выделенный сервер отладки 1С как сервис ([файл с примером регистрации сервиса ./tools/reg dbgs 1550.cmd](./tools/reg%20dbgs%201550.cmd))
3. В параметрах запуска сервера 1С включаем использование отладки по протоколу HTTP и параметры сервера отладки
   `...\1cv8\...\bin\ragent.exe ... -debug -http -debugServerAddr localhost -debugServerPort 11550 ...`
   где
   `-debugServerAddr localhost` - адрес прокси-сервера отладки
   `-debugServerPort 11550` - порт прокси-сервера отладки (проброшен из docker)

4. В параметрах отладки (в конфигураторе) указываем использование протокола HTTP, адрес сервера 1С и порт
   `localhost 11550`

   где `11550` - порт прокси, проброшенный из docker-контейнера

5. Запускаем конфигуратор, запускаем отладку.
6. Включаем замер производительности, выполняем "тестовые" действия, выключаем замер

На логи прокси (proxy/log/nginx_access.log) натравливаем скрипт "ПокрытиеМодулей.os" (пока нужно поправить пути в разделе программы модуля).

Можно поиграться с тестовыми данными (конфигурация + лог) из каталога "./tests/fixtures", тогда пути править не надо.

Смотрим результат в "test-result".

### Проблемы:
1. Пока "не всегда" ловятся результаты выполнения кода на сервере (вроде как использование выделенного сервера отладки проблему решает)
2. Как автоматизировать включение/выключение замера производительности

### Дополнительно:
1. Получилась полезная заготовка для парсинга каталога выгрузки конфигурации "src/Классы/Конфигурация.os"
2. Есть процедура для получения кода из модулей "src/ПокрытиеМодулей.os::ПолучитьСтрокиМодуля()" (игнорирует пустые строки, коментарии и строки переноса текста)
